test_name: Make sure meta endpoints work

includes:
  - !include includes/auth_stage.yaml
  - !include includes/listener_stage.yaml

stages:
  - type: ref
    id: login_get_token
  - type: ref
    id: start_http_listener
  - name: Verify all stagers get
    request:
      params:
        token: "{test_login_token}"
      verify: false
      url: http://localhost:1337/api/stagers/
      method: GET
      headers:
        content-type: application/json
    response:
      status_code: 200
      body: { "stagers": !anylist }

  - name: Verify a stager returns
    request:
      params:
        token: "{test_login_token}"
      verify: false
      url: http://localhost:1337/api/stagers/osx-application
      method: GET
      headers:
        content-type: application/json
    response:
      status_code: 200
      body: !include includes/stager_osx_response.json

  - name: Verify Generate Stager No File
    request:
      params:
        token: "{test_login_token}"
      json: !include includes/stager_generate_request.json
      verify: false
      url: http://localhost:1337/api/stagers/osx-launcher
      method: POST
      headers:
        content-type: application/json
    response:
      status_code: 200
      body: !include includes/stager_generate_response.json

  - name: Verify Generate Stager With File
    request:
      params:
        token: "{test_login_token}"
      json: !include includes/stager_generate_file_request.json
      verify: false
      url: http://localhost:1337/api/stagers/osx-application
      method: POST
      headers:
        content-type: application/json
    response:
      status_code: 200
      body: !include includes/stager_generate_file_response.json
    # todo validate output converts to a file properly.
